@model IEnumerable<TestParkingSystem.Models.Occupants>

    <br />
    <center>
    <input type="text" class="form-control" id="searchBox" placeholder="Search..." style="width:80%;"><br />
    </center>
<br />

  
<div class="container d-flex flex-wrap" style="width:100%;">
        @foreach (var item in Model)
        {
       
            @using (Html.BeginForm("Delete", "Occupants", FormMethod.Post, new { @name = "Form4" }))
            {
            <div class="row m-2">
                <div class="col">
                    <div class="card bg-secondary mb-3" style="width:100%;">
                        <div class="card-body">
                            <center>
                                <img src="https://cdn.icon-icons.com/icons2/1378/PNG/512/avatardefault_92824.png" style="width:100px;height:100px;">
                 

                            <h6 class="card-title"><strong>@item.FullName</strong></h6>
                            </center>
                             <p class="card-text"><strong>Plate Number:</strong>@item.PlateNumber<br /><strong>Contact Number:</strong>@item.PlateNumber<br /><strong>Vehicle:</strong>@item.Vehicle</p>
                    
                        </div>
                        <div class="card-footer">
                            <button name="@item.FullName|@item.ContactNumber|@item.PlateNumber|@item.Vehicle" type="button" id="editUser" class="btn btn-primary" style="width:5rem;">Edit</button>
                            <button name="@item.FullName" type="button" id="ddlDeleteUser" class="btn btn-danger" style="width:5rem;">Delete</button>
                        </div>
                    </div>
                 </div>
            </div>
           
                @Html.Hidden("userToDelete", null , new{id = "hfUserToDelete"})
           
            }

       
        }

</div>


<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <h5>Add new Vehicle</h5>
        <span class="close">&times;</span>



        </div>
        <center>
            <div class="modal-body">
                @using (Html.BeginForm("Register", "Occupants", FormMethod.Post, new { @name = "Form3" }))
                {
                    <div class="form-group">
                        <input type="text" class="form-control" id="fullName" placeholder="Full Name" style="width:80%;" required><br />
                        <input type="text" class="form-control" id="plateNumber" placeholder="Plate Number" style="width:80%;" required><br />
                        <input type="number" class="form-control" id="contactNumber" placeholder="Contact Number" style="width:80%;" required><br />
                        <label for="exampleSelect1" class="form-label mt-4">Vehicle Type:</label>
                            <select class="form-select" id="vehicleType" style="width:80%;">
                            <option>Car</option>
                            <option>Motorcycle</option>
                            <option>Bicycle</option>
                        </select>
                    </div>
                    @Html.Hidden("fullname", null , new{id = "hfFullName"})
                    @Html.Hidden("platenumber", null , new{id = "hfPlateNumber"})
                    @Html.Hidden("contactnumber", null , new{id = "hfContactNumber"})
                    @Html.Hidden("vehicleType", null , new{id = "hfVehicleType"})
                          <br />
                     <button type="button" class="btn btn-primary" id="ddlSubmit" stlye="width:20rem;">Submit</button>

                  

                    <br>

                    <br>
                }
            </div>

        </center>
    </div>

</div>
<!-- Edit User -->

<div id="myModalEdit" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <h5>Edit User</h5>
            <span class="closeEdit">&times;</span>



        </div>
        <center>
            <div class="modal-body">
                @using (Html.BeginForm("EditUser", "Occupants", FormMethod.Post, new { @name = "Form5" }))
                {
                        <div class="form-group">
                            <strong>Full Name</strong>
                            <input type="text" class="form-control" id="fullNameEdit" placeholder="Full Name" style="width:80%;" required><br />
                            <strong>Plate Number</strong>
                            <input type="text" class="form-control" id="plateNumberEdit" placeholder="Plate Number" style="width:80%;" required><br />
                            <strong>Contact Number</strong>
                            <input type="number" class="form-control" id="contactNumberEdit" placeholder="Contact Number" style="width:80%;" required><br />
                            <strong>Vehicle </strong>
                            <select class="form-select" id="vehicleTypeEdit" style="width:80%;">
                                <option>Car</option>
                                <option>Motorcycle</option>
                                <option>Bicycle</option>
                            </select>
                        </div>
                    @Html.Hidden("fullNameOriginal", null , new{id = "hfFullNameOriginal"})
                    @Html.Hidden("fullnameEdit", null , new{id = "hfFullNameEdit"})
                    @Html.Hidden("platenumberEdit", null , new{id = "hfPlateNumberEdit"})
                    @Html.Hidden("contactnumberEdit", null , new{id = "hfContactNumberEdit"})
                    @Html.Hidden("vehicleTypeEdit", null , new{id = "hfVehicleTypeEdit"})
                        <br />
                        <button type="button" class="btn btn-primary" id="ddlSubmitEdit" stlye="width:20rem;">Submit</button>

                

                        <br>

                        <br>
                }
            </div>

        </center>
    </div>

</div>

<button type="button" class="btn btn-secondary" id="myBtn" stlye="width:10rem;">Add new Vehicle</button>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">

    var go;

    //register user
    var modal = document.getElementById("myModal");
    var btn = document.getElementById("myBtn");
    var span = document.getElementsByClassName("close")[0];
    

    btn.onclick = function () {
        modal.style.display = "block";
    }
    span.onclick = function () {
        modal.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    //end of register user

    //edit user
    var modalEdit = document.getElementById("myModalEdit");
    var btnEdit = document.getElementById("editUser");
    var spanEdit = document.getElementsByClassName("closeEdit")[0];
    $("body").on("click", "#editUser", function () {
        var details = this.getAttribute("name");
       
        const detailsArr = details.split("|");
        var fullNameEdit = detailsArr[0];
        var contactNumberEdit = detailsArr[1];
        var plateNumberEdit = detailsArr[2];
        var vehicleTypeEdit = detailsArr[3];
        $("#hfFullNameOriginal").val(fullNameEdit);
        $("#fullNameEdit").val(fullNameEdit);
        $("#plateNumberEdit").val(plateNumberEdit);
        $("#contactNumberEdit").val(contactNumberEdit);
        $("#vehicleTypeEdit").val(vehicleTypeEdit);
        modalEdit.style.display = "block";
    });
    spanEdit.onclick = function () {
        modalEdit.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modalEdit.style.display = "none";
        }
    }
    //end of edit user
    //register user function 
    $("body").on("click", "#ddlSubmit", function () {
        var fullname = $("#fullName").val();
        var vehicle = $("#vehicleType").val();
        var platenumber = $("#plateNumber").val();
        var contactnumber = $("#contactNumber").val();
        if(fullname && contactnumber && platenumber){
            var validPhone = /^\d{11}$/;
            if(contactnumber.match(validPhone)){
                swal({
                    title: "Register a "+vehicle,
                    text: "under the name of "+fullname,
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {

                            $("#hfFullName").val(fullname);
                            $("#hfContactNumber").val(contactnumber);
                            $("#hfVehicleType").val(vehicle);
                            $("#hfPlateNumber").val(platenumber);
                            go = setTimeout(register);

                        } else {
                            swal("Changes not saved!");
                        }
                    });
                }else{
                swal("Input valid phone number", " ", "error");
                }


         }else{
             swal("Please fill all forms"," ", "error");
         }

    });
    //end of register user function
    //edit user function
    $("body").on("click", "#ddlSubmitEdit", function () {
        var fullname = $("#fullNameEdit").val();
        var vehicle = $("#vehicleTypeEdit").val();
        var platenumber = $("#plateNumberEdit").val();
        var contactnumber = $("#contactNumberEdit").val();
         var orig = $("#hfFullNameOriginal").val();
        
        if (fullname && contactnumber && platenumber) {
            var validPhone = /^\d{11}$/;
            if (contactnumber.match(validPhone)) {
                swal({
                    title: "Edit this Occupant?",
                    text: " ",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {

                            $("#hfFullNameEdit").val(fullname);
                            $("#hfContactNumberEdit").val(contactnumber);
                            $("#hfVehicleTypeEdit").val(vehicle);
                            $("#hfPlateNumberEdit").val(platenumber);
                           
                           
                            go = setTimeout(editUser);

                        } else {
                            swal("Changes not saved!");
                        }
                    });
            } else {
                swal("Input valid phone number", " ", "error");
            }


        } else {
            swal("Please fill all forms", " ", "error");
        }

    });

    $("body").on("click", "#ddlDeleteUser", function () {
       var userToDelete = this.getAttribute("name");
        swal({
            title: "Delete "+userToDelete+"?",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {

                   $("#hfUserToDelete").val(userToDelete);

                    go = setTimeout(deleteUser);

                } else {
                    swal("Changes not saved!");
                }
            });
    });

   function deleteUser() {

        swal({
                title: "Deleting user...",
                text:" ",
                icon: "https://cdn.dribbble.com/users/2245289/screenshots/6835230/dribbble.gif",
                buttons: false,      
                closeOnClickOutside: false,
                timer: 90000,
                //icon: "success"
            });

        document.forms["Form4"].submit();
    }



    function register() {

        swal({
                title: "Registering new Vehicle...",
                text:" ",
                icon: "https://cdn.dribbble.com/users/2245289/screenshots/6835230/dribbble.gif",
                buttons: false,      
                closeOnClickOutside: false,
                timer: 90000,
                //icon: "success"
            });

        document.forms["Form3"].submit();
    }

     function editUser() {

        swal({
                title: "Updating Occupant...",
                text:" ",
                icon: "https://cdn.dribbble.com/users/2245289/screenshots/6835230/dribbble.gif",
                buttons: false,      
                closeOnClickOutside: false,
                timer: 90000,
                //icon: "success"
            });

        document.forms["Form5"].submit();
    }

    const searchBox = document.getElementById('searchBox');

    searchBox.addEventListener('keyup', e =>{
        let currentValue = e.target.value.toLowerCase();
        let occupants = document.querySelectorAll('h6.card-title');
        occupants.forEach(occupants =>{
            if(occupants.textContent.toLowerCase().includes(currentValue)){
                occupants.parentNode.parentNode.parentNode.parentNode.parentNode.style.display = 'block';
            }else{
                occupants.parentNode.parentNode.parentNode.parentNode.parentNode.style.display = 'none' 
            }
        })
    });


</script>


@if (TempData["Message"] != null)
{
    <script>
        $(function () {
            if ("@TempData["Message"]" == "Success") {
                swal("@TempData["Message"]", "", "success");
            } else {
                swal("Oops!", "@TempData["Message"]", "error");
            }
        });
    </script>
}

